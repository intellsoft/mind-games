<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Ø¨Ø§Ø²ÛŒ Ú©Ø§Ú©ÙˆØ±Ùˆ Ø¢Ù†Ù„Ø§ÛŒÙ† - ØªØ±Ú©ÛŒØ¨ Ø³ÙˆØ¯ÙˆÚ©Ùˆ Ùˆ Ø¬Ø¯ÙˆÙ„ Ú©Ù„Ù…Ø§Øª Ù…ØªÙ‚Ø§Ø·Ø¹ Ø¨Ø§ Ø§Ø¹Ø¯Ø§Ø¯">
    <title>Ú©Ø§Ú©ÙˆØ±Ùˆ | Ø¨Ø§Ø²ÛŒ ÙÚ©Ø±ÛŒ Ø¹Ø¯Ø¯ÛŒ Ú˜Ø§Ù¾Ù†ÛŒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ ØªÙ… */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --accent-light: #ff6b6b;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #2c3e50;
            --text-light: #7f8c8d;
            --border-color: #dfe6e9;
            --grid-bg: #ffffff;
            --grid-cell: #f8f9fa;
            --grid-black: #2c3e50;
            --grid-line: #bdc3c7;
            --grid-hint: #3498db;
            --grid-user: #27ae60;
            --grid-error: #e74c3c;
            --shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 10px 25px rgba(0, 0, 0, 0.12);
        }

        .dark-theme {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --accent-light: #ff6b6b;
            --success-color: #2ecc71;
            --warning-color: #f1c40f;
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --text-color: #e0e0e0;
            --text-light: #b0b0b0;
            --border-color: #2d4059;
            --grid-bg: #0f3460;
            --grid-cell: #1a3a5f;
            --grid-black: #1a1a2e;
            --grid-line: #2d4059;
            --grid-hint: #3498db;
            --grid-user: #27ae60;
            --grid-error: #e74c3c;
            --shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
            --shadow-hover: 0 10px 25px rgba(0, 0, 0, 0.35);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 0 15px;
        }

        header {
            text-align: center;
            padding: 25px 0;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border-color);
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
            max-width: 900px;
            margin: 0 auto 20px;
        }

        .game-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
        }

        .control-title {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
            outline: none;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: var(--secondary-color); }
        .btn-secondary { background-color: var(--accent-color); color: white; }
        .btn-secondary:hover { background-color: var(--accent-light); }
        .btn-success { background-color: var(--success-color); color: white; }
        .btn-success:hover { background-color: #219653; }
        .btn-outline { background-color: transparent; color: var(--primary-color); border: 2px solid var(--primary-color); }
        .btn-outline:hover { background-color: var(--primary-color); color: white; }

        .difficulty-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin: 5px;
        }

        .badge-easy { background-color: #d4edda; color: #155724; }
        .badge-medium { background-color: #fff3cd; color: #856404; }
        .badge-hard { background-color: #f8d7da; color: #721c24; }
        .dark-theme .badge-easy { background-color: #1e4620; color: #d4edda; }
        .dark-theme .badge-medium { background-color: #5d4a00; color: #fff3cd; }
        .dark-theme .badge-hard { background-color: #5c1c24; color: #f8d7da; }

        .game-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1100px) {
            .game-content { grid-template-columns: 1fr; }
        }

        .game-board-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            overflow: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .kakuro-board {
            border-collapse: collapse;
            background-color: var(--grid-bg);
            box-shadow: 0 0 0 1px var(--grid-line);
            margin-top: 10px;
        }

        .kakuro-board td {
            width: 55px;
            height: 55px;
            border: 1px solid var(--grid-line);
            text-align: center;
            vertical-align: middle;
            position: relative;
            font-weight: 700;
            font-size: 1.2rem;
            user-select: none;
        }

        .kakuro-board td.black-cell {
            background-color: var(--grid-black);
            border: 1px solid var(--grid-black);
        }

        .kakuro-board td.input-cell {
            background-color: var(--grid-cell);
            cursor: pointer;
            transition: background-color 0.1s;
        }

        .kakuro-board td.input-cell:hover {
            background-color: color-mix(in srgb, var(--grid-cell) 90%, var(--primary-color) 10%);
        }

        .kakuro-board td.input-cell.selected {
            background-color: color-mix(in srgb, var(--grid-cell) 60%, var(--primary-color) 40%) !important;
            box-shadow: inset 0 0 0 2px var(--secondary-color);
        }

        .kakuro-board td.input-cell.user-filled { color: var(--grid-user); }
        .kakuro-board td.input-cell.error {
            color: var(--grid-error);
            background-color: color-mix(in srgb, var(--grid-cell) 85%, var(--grid-error) 15%);
        }

        .hint-container {
            position: absolute;
            font-size: 0.7rem;
            font-weight: 700;
            color: var(--grid-hint);
            line-height: 1;
        }

        .hint-down { bottom: 4px; left: 4px; } /* ØªÙ†Ø¸ÛŒÙ… Ù…Ú©Ø§Ù† Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± */
        .hint-right { top: 4px; right: 4px; }

        .hint-line { position: absolute; background-color: var(--grid-line); }
        .hint-line-horizontal { width: 100%; height: 1px; top: 0; left: 0; transform-origin: top left; transform: rotate(45deg); }
        
        /* Ø®Ø· Ù…ÙˆØ±Ø¨ Ø¨Ø±Ø§ÛŒ Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø±Ø§Ù‡Ù†Ù…Ø§ */
        .diagonal-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top right, transparent calc(50% - 0.5px), var(--grid-line) calc(50% - 0.5px), var(--grid-line) calc(50% + 0.5px), transparent calc(50% + 0.5px));
        }

        .game-info { display: flex; flex-direction: column; gap: 25px; }
        .info-card { background-color: var(--card-bg); border-radius: 12px; padding: 25px; box-shadow: var(--shadow); }
        
        .timer-display {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 15px 0;
            font-family: monospace;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.5s ease-out;
        }

        .number-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .number-btn {
            padding: 15px;
            font-size: 1.4rem;
            font-weight: 700;
            background-color: var(--bg-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-color);
            touch-action: manipulation;
        }

        .number-btn:active { background-color: var(--primary-color); color: white; }
        .number-btn.clear { grid-column: span 3; background-color: var(--accent-color); color: white; }

        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 2px solid var(--border-color);
            color: var(--text-light);
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--card-bg);
            color: var(--text-color);
            border: none;
            box-shadow: var(--shadow);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            z-index: 100;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            box-shadow: var(--shadow-hover);
            position: relative;
            text-align: center;
        }

        .modal-close {
            position: absolute;
            top: 15px; left: 15px;
            font-size: 1.8rem;
            background: none; border: none;
            color: var(--text-light);
            cursor: pointer;
        }

        .success-message {
            position: fixed;
            top: 20px; right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 1000;
            display: flex; align-items: center; gap: 15px;
            animation: slideIn 0.5s, slideOut 0.5s 4.5s;
        }

        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100%); opacity: 0; } }

        @media (max-width: 768px) {
            .kakuro-board td { width: 40px; height: 40px; font-size: 1rem; }
            .hint-container { font-size: 0.6rem; }
            .btn { padding: 8px 12px; font-size: 0.85rem; }
            h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" id="themeToggle"><i class="fas fa-moon"></i></button>

    <div class="container">
        <header>
            <h1><i class="fas fa-calculator"></i> Ú©Ø§Ú©ÙˆØ±Ùˆ <span style="color: var(--accent-color);">Ù¾Ø±Ùˆ</span></h1>
            <p class="subtitle">Ø¬Ø¯ÙˆÙ„ Ú©Ù„Ù…Ø§Øª Ù…ØªÙ‚Ø§Ø·Ø¹ Ø¹Ø¯Ø¯ÛŒ - Ø§Ø¹Ø¯Ø§Ø¯ Û± ØªØ§ Û¹ Ø±Ø§ Ø·ÙˆØ±ÛŒ Ø¨Ú†ÛŒÙ†ÛŒØ¯ Ú©Ù‡ Ø¬Ù…Ø¹ Ø¢Ù†â€ŒÙ‡Ø§ Ø¨Ø§ Ø±Ø§Ù‡Ù†Ù…Ø§ Ø¨Ø±Ø§Ø¨Ø± Ø´ÙˆØ¯.</p>
        </header>

        <div class="game-controls">
            <div class="control-card">
                <h2 class="control-title"><i class="fas fa-sliders-h"></i> Ø³Ø·Ø­ Ø¯Ø´ÙˆØ§Ø±ÛŒ</h2>
                <div class="btn-group">
                    <button class="btn btn-primary difficulty-btn active" data-level="easy">Ø¢Ø³Ø§Ù† (ÛµÃ—Ûµ)</button>
                    <button class="btn btn-outline difficulty-btn" data-level="medium">Ù…ØªÙˆØ³Ø· (Û·Ã—Û·)</button>
                    <button class="btn btn-outline difficulty-btn" data-level="hard">Ø³Ø®Øª (Û¹Ã—Û¹)</button>
                </div>
            </div>
            
            <div class="control-card">
                <h2 class="control-title"><i class="fas fa-gamepad"></i> Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§</h2>
                <div class="btn-group">
                    <button class="btn btn-secondary" id="newGameBtn"><i class="fas fa-plus-circle"></i> Ø¬Ø¯ÛŒØ¯</button>
                    <button class="btn btn-success" id="hintBtn"><i class="fas fa-lightbulb"></i> Ø±Ø§Ù‡Ù†Ù…Ø§ (<span id="hintCountBtn">5</span>)</button>
                    <button class="btn btn-primary" id="checkBtn"><i class="fas fa-check-circle"></i> Ø¨Ø±Ø±Ø³ÛŒ</button>
                    <button class="btn btn-outline" id="undoBtn"><i class="fas fa-undo"></i> Ø¨Ø§Ø²Ú¯Ø´Øª</button>
                </div>
            </div>
            
            <div class="control-card">
                <h2 class="control-title"><i class="fas fa-keyboard"></i> ÙˆØ±ÙˆØ¯ÛŒ</h2>
                <div class="number-pad">
                    <button class="number-btn" data-number="1">1</button>
                    <button class="number-btn" data-number="2">2</button>
                    <button class="number-btn" data-number="3">3</button>
                    <button class="number-btn" data-number="4">4</button>
                    <button class="number-btn" data-number="5">5</button>
                    <button class="number-btn" data-number="6">6</button>
                    <button class="number-btn" data-number="7">7</button>
                    <button class="number-btn" data-number="8">8</button>
                    <button class="number-btn" data-number="9">9</button>
                    <button class="number-btn clear" id="clearBtn"><i class="fas fa-eraser"></i> Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
                </div>
            </div>
        </div>

        <div class="game-content">
            <div class="game-board-container">
                <h2 style="color: var(--primary-color); margin-bottom: 15px;">
                    <span id="currentDifficultyBadge" class="difficulty-badge badge-easy">Ø³Ø·Ø­ Ø¢Ø³Ø§Ù†</span>
                </h2>
                <div id="kakuroContainer"></div>
            </div>
            
            <div class="game-info">
                <div class="info-card">
                    <h3 style="text-align: center;"><i class="fas fa-clock"></i> Ø²Ù…Ø§Ù†</h3>
                    <div class="timer-display" id="timer">Û°Û°:Û°Û°</div>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button class="btn btn-outline" id="pauseBtn"><i class="fas fa-pause"></i> ØªÙˆÙ‚Ù</button>
                        <button class="btn btn-outline" id="resetTimerBtn"><i class="fas fa-redo"></i> Ø±ÛŒØ³Øª</button>
                    </div>
                </div>
                
                <div class="info-card">
                    <h3><i class="fas fa-chart-line"></i> Ù¾ÛŒØ´Ø±ÙØª</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div style="text-align: center; font-weight: bold;" id="progressText">Û°%</div>
                </div>

                <div class="info-card">
                    <h3><i class="fas fa-trophy"></i> Ø¢Ù…Ø§Ø± Ø´Ù…Ø§</h3>
                    <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary-color);" id="gamesSolved">0</div>
                            <div style="font-size: 0.8rem; color: var(--text-light);">Ø­Ù„ Ø´Ø¯Ù‡</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-color);" id="hintsUsed">0</div>
                            <div style="font-size: 0.8rem; color: var(--text-light);">Ø±Ø§Ù‡Ù†Ù…Ø§</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal" id="hintModal">
            <div class="modal-content">
                <button class="modal-close" id="closeHintModal">&times;</button>
                <i class="fas fa-lightbulb" style="font-size: 3rem; color: var(--warning-color); margin-bottom: 20px;"></i>
                <h3>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯</h3>
                <div id="hintContent" style="margin: 20px 0; font-size: 1.1rem;"></div>
                <button class="btn btn-success" id="applyHintBtn" style="margin: 0 auto;">Ø§Ø¹Ù…Ø§Ù„ Ø±Ø§Ù‡Ù†Ù…Ø§</button>
            </div>
        </div>
        
        <footer>
            <p>Â© 2026 Ø¨Ø§Ø²ÛŒ Ú©Ø§Ú©ÙˆØ±Ùˆ Ù‡ÙˆØ´Ù…Ù†Ø¯ | Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø¨Ø§ Ø¹Ø´Ù‚ Ùˆ Ù…Ù†Ø·Ù‚</p>
        </footer>
    </div>

    <script>
        // ==================== Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ ====================
        const kakuroPuzzles = {
            easy: {
                size: 5,
                maxNumber: 4,
                // Ø³Ø§Ø®ØªØ§Ø±: #=Ø³ÛŒØ§Ù‡ØŒ "Ø¹Ø¯Ø¯\"=Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø±Ø§Ø³ØªØŒ "Ø¹Ø¯Ø¯â†“"=Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾Ø§ÛŒÛŒÙ†ØŒ 0=Ø®Ø§Ù„ÛŒ
                board: [
                    ['#', '3\\', '4\\', '#', '6\\'],
                    ['3â†“', 0, 0, '4â†“', 0],
                    ['4â†“', 0, 0, '6â†“', 0],
                    ['#', '7\\', '3\\', '#', '4\\'],
                    ['7â†“', 0, '3â†“', 0, '4â†“']
                ],
                solution: [
                    ['#', '3\\', '4\\', '#', '6\\'],
                    ['3â†“', 1, 2, '4â†“', 2],
                    ['4â†“', 3, 1, '6â†“', 2],
                    ['#', '7\\', '3\\', '#', '4\\'],
                    ['7â†“', 4, '3â†“', 1, '4â†“']
                ]
            },
            medium: {
                size: 7,
                maxNumber: 6,
                board: [
                    ['#', '4\\', '6\\', '#', '7\\', '#', '10\\'],
                    ['4â†“', 0, 0, '6â†“', 0, '7â†“', 0],
                    ['6â†“', 0, 0, '10â†“', 0, '12â†“', 0],
                    ['#', '8\\', '#', '12\\', '#', '9\\', '#'],
                    ['8â†“', 0, '10â†“', 0, '9â†“', 0, '12â†“'],
                    ['12â†“', 0, '15â†“', 0, '7â†“', 0, '8â†“'],
                    ['#', '6\\', '#', '7\\', '#', '5\\', '#']
                ],
                solution: [
                    ['#', '4\\', '6\\', '#', '7\\', '#', '10\\'],
                    ['4â†“', 1, 3, '6â†“', 2, '7â†“', 4],
                    ['6â†“', 3, 3, '10â†“', 6, '12â†“', 6],
                    ['#', '8\\', '#', '12\\', '#', '9\\', '#'],
                    ['8â†“', 2, '10â†“', 4, '9â†“', 5, '12â†“'],
                    ['12â†“', 6, '15â†“', 6, '7â†“', 2, '8â†“'],
                    ['#', '6\\', '#', '7\\', '#', '5\\', '#']
                ]
            },
            hard: {
                size: 9,
                maxNumber: 9,
                board: [
                    ['#', '10\\', '14\\', '#', '17\\', '#', '12\\', '#', '8\\'],
                    ['10â†“', 0, 0, '17â†“', 0, '12â†“', 0, '8â†“', 0],
                    ['14â†“', 0, 0, '24â†“', 0, '16â†“', 0, '15â†“', 0],
                    ['#', '13\\', '#', '11\\', '#', '9\\', '#', '7\\', '#'],
                    ['13â†“', 0, '11â†“', 0, '9â†“', 0, '7â†“', 0, '12â†“'],
                    ['19â†“', 0, '23â†“', 0, '14â†“', 0, '16â†“', 0, '18â†“'],
                    ['#', '8\\', '#', '6\\', '#', '10\\', '#', '5\\', '#'],
                    ['8â†“', 0, '6â†“', 0, '10â†“', 0, '5â†“', 0, '9â†“'],
                    ['11â†“', 0, '13â†“', 0, '7â†“', 0, '8â†“', 0, '6â†“']
                ],
                solution: [
                    ['#', '10\\', '14\\', '#', '17\\', '#', '12\\', '#', '8\\'],
                    ['10â†“', 1, 9, '17â†“', 8, '12â†“', 7, '8â†“', 5],
                    ['14â†“', 9, 5, '24â†“', 9, '16â†“', 9, '15â†“', 7],
                    ['#', '13\\', '#', '11\\', '#', '9\\', '#', '7\\', '#'],
                    ['13â†“', 4, '11â†“', 9, '9â†“', 2, '7â†“', 5, '12â†“'],
                    ['19â†“', 9, '23â†“', 9, '14â†“', 9, '16â†“', 9, '18â†“'],
                    ['#', '8\\', '#', '6\\', '#', '10\\', '#', '5\\', '#'],
                    ['8â†“', 7, '6â†“', 1, '10â†“', 5, '5â†“', 2, '9â†“'],
                    ['11â†“', 9, '13â†“', 9, '7â†“', 4, '8â†“', 6, '6â†“']
                ]
            }
        };

        // ==================== ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ ====================
        let gameState = {
            level: 'easy',
            board: [],
            solution: [],
            userBoard: [],
            selected: null,
            active: false,
            paused: false,
            hints: 5,
            history: [],
            stats: { solved: 0, hintsUsed: 0 },
            timer: { start: 0, elapsed: 0, interval: null }
        };

        // ==================== ØªÙˆØ§Ø¨Ø¹ Ø§ØµÙ„ÛŒ ====================

        function init() {
            loadStats();
            loadTheme();
            setupEvents();
            startNewGame('easy');
        }

        function startNewGame(level) {
            stopTimer();
            gameState.level = level;
            const puzzle = kakuroPuzzles[level];
            
            // Ú©Ù¾ÛŒ Ø¹Ù…ÛŒÙ‚ Ø§Ø² Ø¢Ø±Ø§ÛŒÙ‡â€ŒÙ‡Ø§
            gameState.board = JSON.parse(JSON.stringify(puzzle.board));
            gameState.solution = JSON.parse(JSON.stringify(puzzle.solution));
            gameState.userBoard = Array(puzzle.size).fill().map(() => Array(puzzle.size).fill(0));
            
            gameState.selected = null;
            gameState.active = true;
            gameState.paused = false;
            gameState.hints = 5;
            gameState.history = [];
            gameState.timer.elapsed = 0;

            updateUIForNewGame(level, puzzle.maxNumber);
            createBoard(puzzle.size);
            startTimer();
            showMsg(`Ø¨Ø§Ø²ÛŒ Ø¬Ø¯ÛŒØ¯ ${level === 'easy' ? 'Ø¢Ø³Ø§Ù†' : level === 'medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ø³Ø®Øª'} Ø´Ø±ÙˆØ¹ Ø´Ø¯`);
        }

        function createBoard(size) {
            const container = document.getElementById('kakuroContainer');
            container.innerHTML = '';
            const table = document.createElement('table');
            table.className = 'kakuro-board';

            for (let r = 0; r < size; r++) {
                const tr = document.createElement('tr');
                for (let c = 0; c < size; c++) {
                    const td = document.createElement('td');
                    const val = gameState.board[r][c];

                    if (val === '#') {
                        td.className = 'black-cell';
                    } else if (typeof val === 'string') {
                        td.className = 'black-cell';
                        td.innerHTML = `<div class="diagonal-line"></div>` + formatHint(val);
                    } else {
                        td.className = 'input-cell';
                        td.dataset.row = r;
                        td.dataset.col = c;
                        td.onclick = () => selectCell(r, c);
                    }
                    tr.appendChild(td);
                }
                table.appendChild(tr);
            }
            container.appendChild(table);
        }

        function formatHint(val) {
            let html = '';
            if (val.includes('\\')) {
                const num = val.split('\\')[0].replace('â†“', ''); // Ø¹Ø¯Ø¯ Ø³Ù…Øª Ú†Ù¾ Ø®Ø·
                const down = val.includes('â†“') ? val.split('\\')[0].replace('â†“', '') : '';
                // Ø¯Ø± ÙØ±Ù…Øª Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ú©Ø§Ú©ÙˆØ±Ùˆ: \ Ø¹Ø¯Ø¯ Ø±Ø§Ø³Øª Ø¨Ø±Ø§ÛŒ Ø¬Ù…Ø¹ Ø§ÙÙ‚ÛŒ Ø§Ø³ØªØŒ Ø¹Ø¯Ø¯ Ù¾Ø§ÛŒÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø¬Ù…Ø¹ Ø¹Ù…ÙˆØ¯ÛŒ
                // Ø§ÛŒÙ†Ø¬Ø§ ÙØ±Ø¶ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… ÙØ±Ù…Øª Ø±Ø´ØªÙ‡: "Ø¹Ø¯Ø¯ Ù¾Ø§ÛŒÛŒÙ†" + "\" ÛŒØ§ "Ø¹Ø¯Ø¯ Ù¾Ø§ÛŒÛŒÙ†" + "â†“"
                // Ø¨ÛŒØ§ÛŒÛŒØ¯ Ø³Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ù†ÛŒÙ…: 
                // Ø§Ú¯Ø± Ø±Ø´ØªÙ‡ Ø´Ø§Ù…Ù„ \ Ø¨ÙˆØ¯ØŒ Ø¹Ø¯Ø¯ Ù‚Ø¨Ù„ Ø§Ø² \ Ø¨Ø±Ø§ÛŒ Ø³ØªÙˆÙ† Ù¾Ø§ÛŒÛŒÙ† Ø§Ø³ØªØŸ Ù†Ù‡ Ù…Ø¹Ù…ÙˆÙ„Ø§ Ø¨Ø±Ø¹Ú©Ø³ Ø§Ø³Øª.
                // Ø§ØµÙ„Ø§Ø­: Ø¹Ø¯Ø¯ Ø±Ø§Ø³Øª \ Ø¨Ø±Ø§ÛŒ Ø±Ø¯ÛŒÙ (Ø§ÙÙ‚ÛŒ)ØŒ Ø¹Ø¯Ø¯ Ú†Ù¾/Ù¾Ø§ÛŒÛŒÙ† Ø¨Ø±Ø§ÛŒ Ø³ØªÙˆÙ† (Ø¹Ù…ÙˆØ¯ÛŒ).
                
                // Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ø±Ø§ÛŒÙ‡: '3\' ÛŒØ¹Ù†ÛŒ 3 Ø¨Ø±Ø§ÛŒ Ø±Ø¯ÛŒÙ Ø±Ø§Ø³ØªØŸ ÛŒØ§ Ø³ØªÙˆÙ† Ù¾Ø§ÛŒÛŒÙ†ØŸ
                // Ù…Ø¹Ù…ÙˆÙ„Ø§ Ø¯Ø± Ú©Ø§Ú©ÙˆØ±Ùˆ Ø¹Ø¯Ø¯ Ø¨Ø§Ù„Ø§ Ø³Ù…Øª Ø±Ø§Ø³Øª Ø¨Ø±Ø§ÛŒ Ø§ÙÙ‚ÛŒ Ø§Ø³Øª.
                
                const parts = val.split('\\');
                // parts[0] Ú†ÛŒØ²ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø³Ù…Øª Ú†Ù¾/Ù¾Ø§ÛŒÛŒÙ† Ø®Ø· Ø§Ø³Øª (Ø¨Ø±Ø§ÛŒ Ø³ØªÙˆÙ†)
                // parts[1] (Ø§Ú¯Ø± Ø¨Ø§Ø´Ø¯) Ú†ÛŒØ²ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø³Ù…Øª Ø±Ø§Ø³Øª/Ø¨Ø§Ù„Ø§ Ø®Ø· Ø§Ø³Øª (Ø¨Ø±Ø§ÛŒ Ø±Ø¯ÛŒÙ)
                
                // Ø§Ù…Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø´Ù…Ø§ Ø¨Ù‡ ØµÙˆØ±Øª '3\' ÛŒØ§ '3â†“' Ø§Ø³Øª.
                // '3\' -> Ø§ÙÙ‚ÛŒ (Row)
                // '3â†“' -> Ø¹Ù…ÙˆØ¯ÛŒ (Col)
                
                if (val.includes('\\')) html += `<div class="hint-container hint-right">${val.replace('\\', '')}</div>`;
            }
            if (val.includes('â†“')) {
                 html += `<div class="hint-container hint-down">${val.replace('â†“', '')}</div>`;
            }
            // Ø§Ú¯Ø± Ù‡Ø± Ø¯Ùˆ Ø±Ø§ Ø¯Ø§Ø´Øª (Ù…Ø«Ù„ Ú¯ÙˆØ´Ù‡)
            if (val.includes('\\') && val.includes('â†“')) {
                 // Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø§Ù„Øª ØªØ±Ú©ÛŒØ¨ÛŒ Ø§Ú¯Ø± Ø¯Ø± Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ø§Ø´Ø¯
                 // ÙØ¹Ù„Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ ÛŒØ§ Ø§ÛŒÙ† Ù‡Ø³ØªÙ†Ø¯ ÛŒØ§ Ø¢Ù†
            }
            return html;
        }

        function selectCell(r, c) {
            if (!gameState.active || gameState.paused) return;
            
            // Ø­Ø°Ù Ø§Ø³ØªØ§ÛŒÙ„ Ù‚Ø¨Ù„ÛŒ
            document.querySelectorAll('.selected').forEach(el => el.classList.remove('selected'));
            
            const cell = document.querySelector(`td[data-row="${r}"][data-col="${c}"]`);
            if (cell) {
                cell.classList.add('selected');
                gameState.selected = { r, c };
            }
        }

        function inputNumber(num) {
            if (!gameState.selected || !gameState.active || gameState.paused) return;
            
            const { r, c } = gameState.selected;
            const prev = gameState.userBoard[r][c];
            
            if (prev === num) return; // ØªØºÛŒÛŒØ±ÛŒ Ù†Ú©Ø±Ø¯Ù‡

            // Ø°Ø®ÛŒØ±Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡
            gameState.history.push({ r, c, prev, new: num });
            
            gameState.userBoard[r][c] = num;
            updateCellVisual(r, c, num);
            updateProgress();
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±ÛŒØ¹ Ø®Ø·Ø§ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ - Ù…Ø«Ù„ Ø³ÙˆØ¯ÙˆÚ©Ùˆ)
            const cell = document.querySelector(`td[data-row="${r}"][data-col="${c}"]`);
            if (num !== 0 && num !== gameState.solution[r][c]) {
                cell.classList.add('error');
            } else {
                cell.classList.remove('error');
            }

            checkWin();
        }

        function updateCellVisual(r, c, num) {
            const cell = document.querySelector(`td[data-row="${r}"][data-col="${c}"]`);
            cell.textContent = num === 0 ? '' : num;
            if (num > 0) cell.classList.add('user-filled');
            else cell.classList.remove('user-filled', 'error');
        }

        function checkWin() {
            let filled = 0, correct = 0, total = 0;
            const size = gameState.board.length;

            for(let r=0; r<size; r++) {
                for(let c=0; c<size; c++) {
                    if (typeof gameState.board[r][c] === 'number') { // Ø®Ø§Ù†Ù‡ Ø®Ø§Ù„ÛŒ
                        total++;
                        if (gameState.userBoard[r][c] !== 0) {
                            filled++;
                            if (gameState.userBoard[r][c] === gameState.solution[r][c]) correct++;
                        }
                    }
                }
            }

            if (filled === total && correct === total) {
                gameState.active = false;
                stopTimer();
                gameState.stats.solved++;
                saveStats();
                showMsg(`ØªØ¨Ø±ÛŒÚ©! Ù…Ø¹Ù…Ø§ Ø¯Ø± Ø²Ù…Ø§Ù† ${formatTime(gameState.timer.elapsed)} Ø­Ù„ Ø´Ø¯! ğŸ‰`, 'success');
            }
        }

        // ==================== Ù…Ù†Ø·Ù‚ Ú©Ù…Ú©ÛŒ ====================

        function undo() {
            if (!gameState.history.length || !gameState.active) return;
            const move = gameState.history.pop();
            gameState.userBoard[move.r][move.c] = move.prev;
            updateCellVisual(move.r, move.c, move.prev);
            selectCell(move.r, move.c);
            updateProgress();
        }

        function useHint() {
            if (gameState.hints <= 0 || !gameState.active) {
                showMsg('ØªØ¹Ø¯Ø§Ø¯ Ø±Ø§Ù‡Ù†Ù…Ø§Ù‡Ø§ÛŒ Ø´Ù…Ø§ ØªÙ…Ø§Ù… Ø´Ø¯Ù‡!', 'warning');
                return;
            }

            // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ
            const emptyCells = [];
            const size = gameState.board.length;
            for(let r=0; r<size; r++) {
                for(let c=0; c<size; c++) {
                    if (typeof gameState.board[r][c] === 'number' && gameState.userBoard[r][c] === 0) {
                        emptyCells.push({r, c});
                    }
                }
            }

            if (emptyCells.length === 0) return;

            const target = emptyCells[Math.floor(Math.random() * emptyCells.length)];
            const val = gameState.solution[target.r][target.c];
            
            // Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„
            const modal = document.getElementById('hintModal');
            document.getElementById('hintContent').innerHTML = `Ø¯Ø± Ø³Ø·Ø± ${target.r+1} Ùˆ Ø³ØªÙˆÙ† ${target.c+1} Ø¹Ø¯Ø¯ <strong>${val}</strong> Ø±Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.`;
            
            document.getElementById('applyHintBtn').onclick = () => {
                inputNumber(val);
                gameState.hints--;
                gameState.stats.hintsUsed++;
                updateStatsUI();
                modal.style.display = 'none';
            };
            
            modal.style.display = 'flex';
        }

        function togglePause() {
            if (!gameState.active) return;
            gameState.paused = !gameState.paused;
            const btn = document.getElementById('pauseBtn');
            
            if (gameState.paused) {
                btn.innerHTML = '<i class="fas fa-play"></i> Ø§Ø¯Ø§Ù…Ù‡';
                document.getElementById('kakuroContainer').style.opacity = '0.1';
            } else {
                btn.innerHTML = '<i class="fas fa-pause"></i> ØªÙˆÙ‚Ù';
                document.getElementById('kakuroContainer').style.opacity = '1';
                // Ø§ØµÙ„Ø§Ø­ Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ù¾Ø±Ø´
                gameState.timer.start = Date.now() - (gameState.timer.elapsed * 1000);
            }
        }

        function resetTimer() {
            if (!gameState.active) return;
            gameState.timer.elapsed = 0;
            // Ø¨Ø§Ú¯â€ŒÚ¯ÛŒØ±ÛŒ: Ø²Ù…Ø§Ù† Ø´Ø±ÙˆØ¹ Ø±Ø§ Ù‡Ù… Ø±ÛŒØ³Øª Ú©Ù†
            gameState.timer.start = Date.now();
            document.getElementById('timer').textContent = 'Û°Û°:Û°Û°';
        }

        function startTimer() {
            gameState.timer.start = Date.now();
            gameState.timer.interval = setInterval(() => {
                if (!gameState.paused && gameState.active) {
                    const now = Date.now();
                    gameState.timer.elapsed = Math.floor((now - gameState.timer.start) / 1000);
                    document.getElementById('timer').textContent = formatTime(gameState.timer.elapsed);
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(gameState.timer.interval);
        }

        function formatTime(sec) {
            const m = Math.floor(sec / 60).toString().padStart(2, '0');
            const s = (sec % 60).toString().padStart(2, '0');
            return `${m}:${s}`;
        }

        function updateProgress() {
            let total = 0, filled = 0;
            const size = gameState.board.length;
            for(let r=0; r<size; r++) {
                for(let c=0; c<size; c++) {
                    if (typeof gameState.board[r][c] === 'number') {
                        total++;
                        if (gameState.userBoard[r][c] > 0) filled++;
                    }
                }
            }
            const pct = total === 0 ? 0 : Math.round((filled / total) * 100);
            document.getElementById('progressFill').style.width = `${pct}%`;
            document.getElementById('progressText').textContent = `${pct}%`;
        }

        // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ ====================

        function setupEvents() {
            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø³Ø·Ø­
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.onclick = () => startNewGame(btn.dataset.level);
            });

            // ØµÙØ­Ù‡ Ú©Ù„ÛŒØ¯ Ù…Ø¬Ø§Ø²ÛŒ
            document.querySelectorAll('.number-btn[data-number]').forEach(btn => {
                btn.onclick = (e) => {
                    e.preventDefault(); // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø²ÙˆÙ…
                    inputNumber(parseInt(btn.dataset.number));
                };
            });

            // Ú©ÛŒØ¨ÙˆØ±Ø¯ ÙÛŒØ²ÛŒÚ©ÛŒ
            document.addEventListener('keydown', (e) => {
                if (!gameState.active || gameState.paused) return;

                if (e.key >= '1' && e.key <= '9') inputNumber(parseInt(e.key));
                if (e.key === 'Backspace' || e.key === 'Delete') inputNumber(0);
                
                // Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø¨Ø§ ÙÙ„Ø´â€ŒÙ‡Ø§ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø´ Ø§Ø² Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ§Ù‡)
                if (gameState.selected && ['ArrowUp','ArrowDown','ArrowLeft','ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                    navigateGrid(e.key);
                }
            });

            // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„
            document.getElementById('newGameBtn').onclick = () => startNewGame(gameState.level);
            document.getElementById('undoBtn').onclick = undo;
            document.getElementById('hintBtn').onclick = useHint;
            document.getElementById('checkBtn').onclick = checkSolution;
            document.getElementById('pauseBtn').onclick = togglePause;
            document.getElementById('resetTimerBtn').onclick = resetTimer;
            document.getElementById('clearBtn').onclick = () => inputNumber(0);
            document.getElementById('themeToggle').onclick = toggleTheme;
            
            // Ù…ÙˆØ¯Ø§Ù„
            document.getElementById('closeHintModal').onclick = () => document.getElementById('hintModal').style.display = 'none';
            window.onclick = (e) => {
                if (e.target.className === 'modal') e.target.style.display = 'none';
            }
        }

        // ØªØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù†Ø§ÙˆØ¨Ø±ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯
        function navigateGrid(key) {
            let { r, c } = gameState.selected;
            const size = gameState.board.length;
            
            // Ø­Ù„Ù‚Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø§ÙˆÙ„ÛŒÙ† Ø®Ø§Ù†Ù‡ Ø®Ø§Ù„ÛŒ Ø¯Ø± Ø¬Ù‡Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø±
            // Ø­Ø¯Ø§Ú©Ø«Ø± 9 Ø¨Ø§Ø± ØªÚ©Ø±Ø§Ø± ØªØ§ Ø¯Ø± Ù„ÙˆÙ¾ Ø¨ÛŒ Ù†Ù‡Ø§ÛŒØª Ù†ÛŒÙØªÛŒÙ…
            for(let i=0; i<size; i++) {
                if (key === 'ArrowUp') r--;
                if (key === 'ArrowDown') r++;
                if (key === 'ArrowLeft') c--;
                if (key === 'ArrowRight') c++;

                // Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø±Ø²Ù‡Ø§
                if (r < 0 || r >= size || c < 0 || c >= size) break;

                // Ø§Ú¯Ø± Ø®Ø§Ù†Ù‡ ÙˆØ±ÙˆØ¯ÛŒ Ø§Ø³Øª (Ø¹Ø¯Ø¯ 0 Ø¯Ø± ØªØ¹Ø±ÛŒÙ Ø¨ÙˆØ±Ø¯)
                if (typeof gameState.board[r][c] === 'number') {
                    selectCell(r, c);
                    break;
                }
            }
        }

        function checkSolution() {
            if (!gameState.active) return;
            let errors = 0;
            const size = gameState.board.length;
            
            for(let r=0; r<size; r++) {
                for(let c=0; c<size; c++) {
                    const uVal = gameState.userBoard[r][c];
                    if (uVal > 0 && uVal !== gameState.solution[r][c]) {
                        errors++;
                        const cell = document.querySelector(`td[data-row="${r}"][data-col="${c}"]`);
                        cell.classList.add('error');
                    }
                }
            }
            
            if (errors === 0) showMsg('Ù‡Ù…Ù‡ Ø§Ø¹Ø¯Ø§Ø¯ ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡ ØªØ§ Ø§ÛŒÙ†Ø¬Ø§ ØµØ­ÛŒØ­ Ù‡Ø³ØªÙ†Ø¯!', 'success');
            else showMsg(`${errors} Ø®Ø·Ø§ Ù¾ÛŒØ¯Ø§ Ø´Ø¯.`, 'warning');
        }

        function updateUIForNewGame(level, maxNum) {
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('btn-primary', 'active');
                btn.classList.add('btn-outline');
                if(btn.dataset.level === level) {
                    btn.classList.remove('btn-outline');
                    btn.classList.add('btn-primary', 'active');
                }
            });

            const badges = { easy: 'Ø¢Ø³Ø§Ù†', medium: 'Ù…ØªÙˆØ³Ø·', hard: 'Ø³Ø®Øª' };
            const badgeClasses = { easy: 'badge-easy', medium: 'badge-medium', hard: 'badge-hard' };
            const badgeEl = document.getElementById('currentDifficultyBadge');
            badgeEl.textContent = `Ø³Ø·Ø­ ${badges[level]}`;
            badgeEl.className = `difficulty-badge ${badgeClasses[level]}`;
            
            document.getElementById('hintCountBtn').textContent = gameState.hints;
            updateStatsUI();
            
            // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ø¯Ø± Ú©ÛŒØ¨ÙˆØ±Ø¯ Ù…Ø¬Ø§Ø²ÛŒ
            document.querySelectorAll('.number-btn[data-number]').forEach(btn => {
                const num = parseInt(btn.dataset.number);
                btn.disabled = num > maxNum;
                btn.style.opacity = num > maxNum ? '0.3' : '1';
            });
        }

        // ==================== Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ Ùˆ Ø°Ø®ÛŒØ±Ù‡â€ŒØ³Ø§Ø²ÛŒ ====================

        function showMsg(txt, type='success') {
            const el = document.createElement('div');
            el.className = 'success-message';
            el.style.backgroundColor = type === 'success' ? 'var(--success-color)' : 'var(--warning-color)';
            el.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : 'exclamation-circle'}"></i> ${txt}`;
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 4000);
        }

        function saveStats() {
            localStorage.setItem('kakuroStats', JSON.stringify(gameState.stats));
            updateStatsUI();
        }

        function loadStats() {
            const saved = localStorage.getItem('kakuroStats');
            if (saved) gameState.stats = JSON.parse(saved);
            updateStatsUI();
        }

        function updateStatsUI() {
            document.getElementById('gamesSolved').textContent = gameState.stats.solved;
            document.getElementById('hintsUsed').textContent = gameState.stats.hintsUsed;
            document.getElementById('hintCountBtn').textContent = gameState.hints;
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            localStorage.setItem('kakuroTheme', isDark ? 'dark' : 'light');
            document.getElementById('themeToggle').innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        }

        function loadTheme() {
            if (localStorage.getItem('kakuroTheme') === 'dark') {
                document.body.classList.add('dark-theme');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            }
        }

        // Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡
        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>