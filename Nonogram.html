<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="بازی نونوگرام پیکسل آرت آنلاین - تست منطق و هوش با معماهای جذاب پیکسلی">
    <meta name="keywords" content="نونوگرام, پیکسل آرت, بازی فکری, بازی منطقی, بازی ژاپنی, بازی آنلاین, معما, هوش, پازل">
    <title>نونوگرام پیکسل آرت | بازی فکری آنلاین</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* متغیرهای تم روشن و تاریک */
        :root {
            /* تم روشن */
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3a1;
            --accent-dark: #3aa68a;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-light: #666666;
            --border-color: #e0e0e0;
            --grid-bg: #f0f2f5;
            --grid-cell: #ffffff;
            --grid-line: #cccccc;
            --grid-marked: #4a6fa5;
            --grid-crossed: #f0f0f0;
            --grid-hint: #ff9a3c;
            --grid-hover: rgba(74, 111, 165, 0.1);
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --danger-color: #f44336;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        /* تم تاریک */
        .dark-theme {
            --primary-color: #5d8cc0;
            --secondary-color: #1e7bb6;
            --accent-color: #56d4b0;
            --accent-dark: #45b699;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --text-light: #a0a0a0;
            --border-color: #333333;
            --grid-bg: #2d2d2d;
            --grid-cell: #252525;
            --grid-line: #444444;
            --grid-marked: #5d8cc0;
            --grid-crossed: #3a3a3a;
            --grid-hint: #ff9a3c;
            --grid-hover: rgba(93, 140, 192, 0.2);
            --success-color: #66bb6a;
            --warning-color: #ffa726;
            --danger-color: #ef5350;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 6px 16px rgba(0, 0, 0, 0.4);
        }

        /* استایل‌های پایه */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Vazirmatn', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        /* هدر */
        header {
            text-align: center;
            padding: 25px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-color);
        }

        h1 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto 20px;
        }

        /* کنترل‌های بازی */
        .game-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .control-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn-secondary {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--accent-dark);
            transform: translateY(-2px);
        }

        .btn-outline {
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .difficulty-selector {
            display: flex;
            gap: 10px;
        }

        .difficulty-btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: 2px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.2s;
        }

        .difficulty-btn.active {
            border-color: var(--primary-color);
            background-color: var(--primary-color);
            color: white;
        }

        /* محتوای اصلی بازی */
        .game-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            justify-content: center;
        }

        .game-board-container {
            flex: 1;
            min-width: 300px;
            max-width: 700px;
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            overflow: auto;
        }

        .game-info {
            flex: 0 0 300px;
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 25px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* تخته بازی */
        .nonogram-board {
            margin: 0 auto;
            border-collapse: collapse;
            background-color: var(--grid-bg);
            box-shadow: 0 0 0 1px var(--grid-line);
        }

        .nonogram-board td {
            width: 28px;
            height: 28px;
            border: 1px solid var(--grid-line);
            text-align: center;
            vertical-align: middle;
            cursor: pointer;
            position: relative;
            background-color: var(--grid-cell);
            transition: background-color 0.15s;
        }

        .nonogram-board td:hover {
            background-color: var(--grid-hover);
        }

        .nonogram-board td.marked {
            background-color: var(--grid-marked);
        }

        .nonogram-board td.crossed::after {
            content: "✕";
            color: var(--text-light);
            font-size: 18px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .nonogram-board td.hint {
            animation: hint-pulse 1.5s infinite;
        }

        @keyframes hint-pulse {
            0% { background-color: var(--grid-hint); }
            50% { background-color: rgba(255, 154, 60, 0.5); }
            100% { background-color: var(--grid-hint); }
        }

        .row-hints, .col-hints {
            background-color: var(--grid-bg);
            color: var(--text-color);
            font-weight: 600;
            font-size: 0.9rem;
            padding: 5px;
            text-align: center;
        }

        .col-hints {
            vertical-align: bottom;
            padding-bottom: 10px;
        }

        .corner-cell {
            background-color: var(--grid-bg) !important;
        }

        /* اطلاعات بازی */
        .timer-container, .hint-container, .progress-container, .stats-container {
            background-color: var(--bg-color);
            padding: 20px;
            border-radius: 10px;
        }

        .timer-display {
            font-size: 2.2rem;
            font-weight: 700;
            text-align: center;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .hint-count {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-color);
            text-align: center;
            margin: 10px 0;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background-color: var(--border-color);
            border-radius: 6px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--accent-color);
            border-radius: 6px;
            width: 0%;
            transition: width 0.5s;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 12px;
            background-color: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 5px;
        }

        /* راهنمای حل */
        .instructions {
            max-width: 800px;
            margin: 40px auto;
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        .instructions h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .instructions-list {
            padding-right: 20px;
            margin-bottom: 20px;
        }

        .instructions-list li {
            margin-bottom: 10px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted var(--text-light);
            cursor: help;
        }

        .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: var(--card-bg);
            color: var(--text-color);
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            right: 50%;
            margin-right: -125px;
            box-shadow: var(--shadow);
            opacity: 0;
            transition: opacity 0.3s;
            border: 1px solid var(--border-color);
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* فوتر و لینک‌های سئو */
        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid var(--border-color);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .seo-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }

        .seo-links a {
            color: var(--primary-color);
            text-decoration: none;
            padding: 8px 15px;
            background-color: var(--card-bg);
            border-radius: 6px;
            transition: all 0.2s;
        }

        .seo-links a:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .developer-link {
            margin-top: 15px;
            font-size: 1rem;
        }

        .developer-link a {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 600;
        }

        .developer-link a:hover {
            text-decoration: underline;
        }

        /* دکمه تم */
        .theme-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--card-bg);
            color: var(--text-color);
            border: none;
            box-shadow: var(--shadow);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            z-index: 100;
        }

        /* مودال اشتراک‌گذاری */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-hover);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 1.5rem;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
        }

        .share-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
        }

        .share-twitter { background-color: #1DA1F2; }
        .share-facebook { background-color: #4267B2; }
        .share-telegram { background-color: #0088cc; }
        .share-whatsapp { background-color: #25D366; }

        /* رسپانسیو */
        @media (max-width: 992px) {
            .game-content {
                flex-direction: column;
            }
            
            .game-info {
                width: 100%;
                max-width: 700px;
                margin: 0 auto;
            }
            
            h1 {
                font-size: 2rem;
            }
        }

        @media (max-width: 768px) {
            .nonogram-board td {
                width: 24px;
                height: 24px;
            }
            
            .timer-display {
                font-size: 1.8rem;
            }
            
            .theme-toggle {
                top: 10px;
                left: 10px;
                width: 45px;
                height: 45px;
            }
        }

        @media (max-width: 576px) {
            .nonogram-board td {
                width: 20px;
                height: 20px;
            }
            
            .difficulty-selector {
                flex-direction: column;
                width: 100%;
            }
            
            .game-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .control-group {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- دکمه تغییر تم -->
    <button class="theme-toggle" id="themeToggle">
        <i class="fas fa-moon"></i>
    </button>

    <div class="container">
        <header>
            <h1><i class="fas fa-puzzle-piece"></i> نونوگرام پیکسل آرت</h1>
            <p class="subtitle">یک بازی فکری جذاب که منطق و هنر را ترکیب می‌کند! اعداد را تحلیل کنید، مربع‌ها را علامت بزنید و تصویر پنهان را کشف نمایید.</p>
        </header>

        <!-- کنترل‌های بازی -->
        <div class="game-controls">
            <div class="control-group">
                <div class="control-label">سطح دشواری</div>
                <div class="difficulty-selector">
                    <button class="difficulty-btn active" data-level="easy">آسان (۵×۵)</button>
                    <button class="difficulty-btn" data-level="medium">متوسط (۱۰×۱۰)</button>
                    <button class="difficulty-btn" data-level="hard">سخت (۱۵×۱۵)</button>
                </div>
            </div>
            
            <div class="control-group">
                <div class="control-label">کنترل بازی</div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" id="newGameBtn">
                        <i class="fas fa-plus-circle"></i> بازی جدید
                    </button>
                    <button class="btn btn-secondary" id="hintBtn">
                        <i class="fas fa-lightbulb"></i> راهنما
                    </button>
                    <button class="btn btn-outline" id="shareBtn">
                        <i class="fas fa-share-alt"></i> اشتراک‌گذاری
                    </button>
                </div>
            </div>
            
            <div class="control-group">
                <div class="control-label">حالت بازی</div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-outline" id="markMode">
                        <i class="fas fa-check-square"></i> علامت‌گذاری
                    </button>
                    <button class="btn btn-outline" id="crossMode">
                        <i class="fas fa-times"></i> خط‌زدن
                    </button>
                </div>
            </div>
        </div>

        <!-- محتوای اصلی بازی -->
        <div class="game-content">
            <!-- تخته بازی -->
            <div class="game-board-container">
                <h2 style="text-align: center; margin-bottom: 20px; color: var(--primary-color);">
                    <i class="fas fa-gamepad"></i> تخته بازی
                </h2>
                <div id="nonogramContainer"></div>
            </div>
            
            <!-- اطلاعات بازی -->
            <div class="game-info">
                <div class="timer-container">
                    <h3><i class="fas fa-clock"></i> زمان حل</h3>
                    <div class="timer-display" id="timer">00:00</div>
                    <div style="text-align: center;">
                        <button class="btn btn-outline" id="pauseBtn" style="margin-top: 10px;">
                            <i class="fas fa-pause"></i> توقف
                        </button>
                    </div>
                </div>
                
                <div class="hint-container">
                    <h3><i class="fas fa-lightbulb"></i> راهنماهای باقیمانده</h3>
                    <div class="hint-count" id="hintCount">5</div>
                    <p style="text-align: center; font-size: 0.9rem; color: var(--text-light);">
                        هر راهنما یک مربع صحیح را نشان می‌دهد
                    </p>
                </div>
                
                <div class="progress-container">
                    <h3><i class="fas fa-chart-line"></i> پیشرفت حل</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div style="text-align: center; font-weight: 600;" id="progressText">0%</div>
                </div>
                
                <div class="stats-container">
                    <h3><i class="fas fa-chart-bar"></i> آمار بازی</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="gamesPlayed">0</div>
                            <div class="stat-label">بازی انجام شده</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="gamesSolved">0</div>
                            <div class="stat-label">معما حل شده</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="avgTime">00:00</div>
                            <div class="stat-label">میانگین زمان</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="hintsUsed">0</div>
                            <div class="stat-label">راهنمای استفاده شده</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- راهنمای حل -->
        <div class="instructions">
            <h2><i class="fas fa-info-circle"></i> راهنمای حل نونوگرام</h2>
            <ul class="instructions-list">
                <li>اعداد در سمت چپ و بالای جدول نشان‌دهنده بلوک‌های مربع‌های پر در هر سطر یا ستون هستند.</li>
                <li>عدد <strong>3</strong> یعنی در آن سطر/ستون، یک بلوک ۳ تایی از مربع‌های پر وجود دارد.</li>
                <li>اعداد متعدد مانند <strong>2 1</strong> یعنی بلوک‌های پر با حداقل یک مربع خالی از هم جدا شده‌اند.</li>
                <li>از دو حالت استفاده کنید: <span class="tooltip">علامت‌گذاری <span class="tooltip-text">برای مربع‌هایی که مطمئن هستید باید پر شوند</span></span> و <span class="tooltip">خط‌زدن <span class="tooltip-text">برای مربع‌هایی که مطمئن هستید باید خالی بمانند</span></span>.</li>
                <li>برای تغییر حالت بین علامت‌گذاری و خط‌زدن از دکمه‌های بالا استفاده کنید یا کلید Space را فشار دهید.</li>
                <li>برای استفاده از راهنما، روی دکمه "راهنما" کلیک کنید تا یک مربع صحیح به شما نشان داده شود.</li>
            </ul>
            <div style="text-align: center;">
                <button class="btn btn-primary" id="showExampleBtn">
                    <i class="fas fa-eye"></i> مشاهده مثال عملی
                </button>
            </div>
        </div>

        <!-- فوتر -->
        <footer>
            <div class="seo-links">
                <a href="https://intellsoft.ir/بازی-فکری">بازی فکری آنلاین</a>
                <a href="https://intellsoft.ir/بازی-منطقی">بازی منطقی</a>
                <a href="https://intellsoft.ir/نونوگرام">نونوگرام آنلاین</a>
                <a href="https://intellsoft.ir/پیکسل-آرت">پیکسل آرت بازی</a>
                <a href="https://intellsoft.ir/بازی-ژاپنی">بازی ژاپنی</a>
                <a href="https://intellsoft.ir/معما-هوش">معماهای هوش</a>
            </div>
            <p class="developer-link">
                طراحی و توسعه توسط <a href="https://intellsoft.ir" target="_blank">IntellSoft</a> - تخصص در تولید نرم‌افزارهای وب و موبایل
            </p>
            <p style="margin-top: 10px;">© 2026 نونوگرام پیکسل آرت - تمامی حقوق محفوظ است.</p>
        </footer>
    </div>

    <!-- مودال اشتراک‌گذاری -->
    <div class="modal" id="shareModal">
        <div class="modal-content">
            <button class="modal-close" id="closeModal">&times;</button>
            <h2 style="color: var(--primary-color); margin-bottom: 20px; text-align: center;">
                <i class="fas fa-share-alt"></i> اشتراک‌گذاری
            </h2>
            <p style="text-align: center; margin-bottom: 20px;">
                بازی خود را با دوستانتان به اشتراک بگذارید!<br>
                <strong id="shareMessage">من یک نونوگرام سطح متوسط را در زمان 00:00 حل کردم!</strong>
            </p>
            
            <div class="share-options">
                <button class="share-btn share-twitter" id="shareTwitter">
                    <i class="fab fa-twitter"></i> توییتر
                </button>
                <button class="share-btn share-facebook" id="shareFacebook">
                    <i class="fab fa-facebook-f"></i> فیسبوک
                </button>
                <button class="share-btn share-telegram" id="shareTelegram">
                    <i class="fab fa-telegram"></i> تلگرام
                </button>
                <button class="share-btn share-whatsapp" id="shareWhatsapp">
                    <i class="fab fa-whatsapp"></i> واتساپ
                </button>
            </div>
            
            <div style="margin-top: 25px; text-align: center;">
                <p style="font-size: 0.9rem; color: var(--text-light);">
                    آدرس بازی: <strong>https://intellsoft.ir/nonogram</strong>
                </p>
            </div>
        </div>
    </div>

    <script>
        // متغیرهای اصلی بازی
        let gameBoard = [];
        let solutionBoard = [];
        let currentLevel = 'easy';
        let boardSize = 5;
        let gameActive = false;
        let gamePaused = false;
        let gameWon = false;
        let gameMode = 'mark'; // 'mark' یا 'cross'
        let hintsRemaining = 5;
        let startTime = null;
        let timerInterval = null;
        let elapsedTime = 0;
        let gamesPlayed = 0;
        let gamesSolved = 0;
        let totalTime = 0;
        let totalHintsUsed = 0;

        // الگوهای از پیش تعریف شده برای هر سطح
        const patterns = {
            easy: {
                size: 5,
                solution: [
                    [1, 1, 0, 0, 0],
                    [0, 1, 1, 0, 0],
                    [0, 0, 1, 1, 0],
                    [0, 0, 0, 1, 1],
                    [1, 0, 0, 0, 1]
                ],
                name: "پیکان مورب"
            },
            medium: {
                size: 10,
                solution: [
                    [0,0,1,1,1,1,1,1,0,0],
                    [0,1,0,0,0,0,0,0,1,0],
                    [1,0,1,0,0,0,0,1,0,1],
                    [1,0,0,1,0,0,1,0,0,1],
                    [1,0,0,0,1,1,0,0,0,1],
                    [1,0,0,0,1,1,0,0,0,1],
                    [1,0,0,1,0,0,1,0,0,1],
                    [1,0,1,0,0,0,0,1,0,1],
                    [0,1,0,0,0,0,0,0,1,0],
                    [0,0,1,1,1,1,1,1,0,0]
                ],
                name: "دایره توخالی"
            },
            hard: {
                size: 15,
                solution: [
                    [0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
                    [0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],
                    [0,0,0,1,0,0,0,0,0,0,1,0,0,0,0],
                    [0,0,1,0,0,0,0,0,0,0,0,1,0,0,0],
                    [0,1,0,0,0,0,0,0,0,0,0,0,1,0,0],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
                    [1,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
                    [0,1,0,0,0,0,0,0,0,0,0,0,1,0,0],
                    [0,0,1,0,0,0,0,0,0,0,0,1,0,0,0],
                    [0,0,0,1,0,0,0,0,0,0,1,0,0,0,0],
                    [0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],
                    [0,0,0,0,0,1,1,1,1,0,0,0,0,0,0],
                    [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
                ],
                name: "الماس بزرگ"
            }
        };

        // بارگذاری آمار از localStorage
        function loadStats() {
            const stats = JSON.parse(localStorage.getItem('nonogramStats')) || {
                gamesPlayed: 0,
                gamesSolved: 0,
                totalTime: 0,
                totalHintsUsed: 0
            };
            
            gamesPlayed = stats.gamesPlayed;
            gamesSolved = stats.gamesSolved;
            totalTime = stats.totalTime;
            totalHintsUsed = stats.totalHintsUsed;
            
            updateStatsDisplay();
        }

        // ذخیره آمار در localStorage
        function saveStats() {
            const stats = {
                gamesPlayed,
                gamesSolved,
                totalTime,
                totalHintsUsed
            };
            
            localStorage.setItem('nonogramStats', JSON.stringify(stats));
        }

        // به روزرسانی نمایش آمار
        function updateStatsDisplay() {
            document.getElementById('gamesPlayed').textContent = gamesPlayed;
            document.getElementById('gamesSolved').textContent = gamesSolved;
            document.getElementById('hintsUsed').textContent = totalHintsUsed;
            
            const avgTime = gamesSolved > 0 ? Math.floor(totalTime / gamesSolved) : 0;
            document.getElementById('avgTime').textContent = formatTime(avgTime);
        }

        // شروع بازی جدید
        function startNewGame(level = currentLevel) {
            // توقف تایمر فعلی
            stopTimer();
            
            // تنظیم سطح جدید
            currentLevel = level;
            boardSize = patterns[level].size;
            
            // ریست کردن متغیرهای بازی
            gameActive = true;
            gamePaused = false;
            gameWon = false;
            hintsRemaining = 5;
            elapsedTime = 0;
            
            // به روزرسانی دکمه‌های سطح دشواری
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.level === level) {
                    btn.classList.add('active');
                }
            });
            
            // ایجاد تخته بازی
            createGameBoard();
            
            // به روزرسانی نمایش راهنماها
            document.getElementById('hintCount').textContent = hintsRemaining;
            
            // به روزرسانی پیشرفت
            updateProgress();
            
            // شروع تایمر
            startTimer();
            
            // افزایش تعداد بازی‌های انجام شده
            gamesPlayed++;
            saveStats();
            updateStatsDisplay();
            
            // نمایش پیام
            showMessage(`بازی جدید ${patterns[level].name} شروع شد!`, 'success');
        }

        // ایجاد تخته بازی
        function createGameBoard() {
            // دریافت الگوی راه‌حل
            solutionBoard = patterns[currentLevel].solution;
            
            // ایجاد تخته بازی خالی
            gameBoard = [];
            for (let i = 0; i < boardSize; i++) {
                gameBoard.push(Array(boardSize).fill(0)); // 0=خالی, 1=علامت‌زده, 2=خط‌خورده
            }
            
            // ساخت HTML تخته بازی
            const container = document.getElementById('nonogramContainer');
            container.innerHTML = '';
            
            // ایجاد جدول
            const table = document.createElement('table');
            table.className = 'nonogram-board';
            
            // محاسبه راهنماهای سطرها و ستون‌ها
            const rowHints = calculateRowHints();
            const colHints = calculateColHints();
            
            // پیدا کردن حداکثر طول راهنماها برای تنظیم اندازه سلول‌ها
            const maxRowHintLength = Math.max(...rowHints.map(hint => hint.length));
            const maxColHintLength = Math.max(...colHints.map(hint => hint.length));
            
            // ایجاد ردیف اول (راهنماهای ستون‌ها)
            const topRow = document.createElement('tr');
            
            // سلول گوشه سمت چپ بالا
            const topLeftCell = document.createElement('td');
            topLeftCell.className = 'corner-cell';
            topLeftCell.innerHTML = '<i class="fas fa-th"></i>';
            topRow.appendChild(topLeftCell);
            
            // راهنماهای ستون‌ها
            for (let c = 0; c < boardSize; c++) {
                const hintCell = document.createElement('td');
                hintCell.className = 'col-hints';
                hintCell.innerHTML = colHints[c].join('<br>');
                hintCell.style.paddingTop = '10px';
                topRow.appendChild(hintCell);
            }
            
            table.appendChild(topRow);
            
            // ایجاد سطرهای بازی
            for (let r = 0; r < boardSize; r++) {
                const row = document.createElement('tr');
                
                // راهنمای سطر
                const hintCell = document.createElement('td');
                hintCell.className = 'row-hints';
                hintCell.innerHTML = rowHints[r].join(' ');
                row.appendChild(hintCell);
                
                // سلول‌های بازی
                for (let c = 0; c < boardSize; c++) {
                    const cell = document.createElement('td');
                    cell.dataset.row = r;
                    cell.dataset.col = c;
                    
                    cell.addEventListener('click', () => handleCellClick(r, c));
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        handleCellRightClick(r, c);
                    });
                    
                    row.appendChild(cell);
                }
                
                table.appendChild(row);
            }
            
            container.appendChild(table);
        }

        // محاسبه راهنماهای سطرها
        function calculateRowHints() {
            const hints = [];
            
            for (let r = 0; r < boardSize; r++) {
                const rowHint = [];
                let count = 0;
                
                for (let c = 0; c < boardSize; c++) {
                    if (solutionBoard[r][c] === 1) {
                        count++;
                    } else if (count > 0) {
                        rowHint.push(count);
                        count = 0;
                    }
                }
                
                if (count > 0) {
                    rowHint.push(count);
                }
                
                hints.push(rowHint.length > 0 ? rowHint : [0]);
            }
            
            return hints;
        }

        // محاسبه راهنماهای ستون‌ها
        function calculateColHints() {
            const hints = [];
            
            for (let c = 0; c < boardSize; c++) {
                const colHint = [];
                let count = 0;
                
                for (let r = 0; r < boardSize; r++) {
                    if (solutionBoard[r][c] === 1) {
                        count++;
                    } else if (count > 0) {
                        colHint.push(count);
                        count = 0;
                    }
                }
                
                if (count > 0) {
                    colHint.push(count);
                }
                
                hints.push(colHint.length > 0 ? colHint : [0]);
            }
            
            return hints;
        }

        // مدیریت کلیک روی سلول
        function handleCellClick(row, col) {
            if (!gameActive || gamePaused || gameWon) return;
            
            const cell = document.querySelector(`td[data-row="${row}"][data-col="${col}"]`);
            
            if (gameMode === 'mark') {
                // حالت علامت‌گذاری
                if (gameBoard[row][col] === 0) {
                    gameBoard[row][col] = 1;
                    cell.classList.add('marked');
                    cell.classList.remove('crossed');
                } else if (gameBoard[row][col] === 1) {
                    gameBoard[row][col] = 0;
                    cell.classList.remove('marked');
                }
            } else {
                // حالت خط‌زدن
                if (gameBoard[row][col] === 0) {
                    gameBoard[row][col] = 2;
                    cell.classList.add('crossed');
                    cell.classList.remove('marked');
                } else if (gameBoard[row][col] === 2) {
                    gameBoard[row][col] = 0;
                    cell.classList.remove('crossed');
                }
            }
            
            // بررسی برنده شدن
            checkWinCondition();
            
            // به روزرسانی پیشرفت
            updateProgress();
        }

        // مدیریت کلیک راست روی سلول
        function handleCellRightClick(row, col) {
            if (!gameActive || gamePaused || gameWon) return;
            
            const cell = document.querySelector(`td[data-row="${row}"][data-col="${col}"]`);
            
            if (gameBoard[row][col] === 0) {
                gameBoard[row][col] = 2;
                cell.classList.add('crossed');
                cell.classList.remove('marked');
            } else if (gameBoard[row][col] === 2) {
                gameBoard[row][col] = 0;
                cell.classList.remove('crossed');
            }
            
            // بررسی برنده شدن
            checkWinCondition();
            
            // به روزرسانی پیشرفت
            updateProgress();
        }

        // بررسی شرایط برنده شدن
        function checkWinCondition() {
            if (!gameActive || gameWon) return;
            
            let correct = true;
            
            for (let r = 0; r < boardSize; r++) {
                for (let c = 0; c < boardSize; c++) {
                    // اگر در راه‌حل باید پر باشد
                    if (solutionBoard[r][c] === 1) {
                        if (gameBoard[r][c] !== 1) {
                            correct = false;
                            break;
                        }
                    } else {
                        // اگر در راه‌حل باید خالی باشد، می‌تواند خالی یا خط‌خورده باشد
                        if (gameBoard[r][c] === 1) {
                            correct = false;
                            break;
                        }
                    }
                }
                if (!correct) break;
            }
            
            if (correct) {
                gameWon = true;
                gameActive = false;
                stopTimer();
                
                // افزایش آمار
                gamesSolved++;
                totalTime += elapsedTime;
                saveStats();
                updateStatsDisplay();
                
                // نمایش پیام تبریک
                showMessage(`تبریک! شما معما را در زمان ${formatTime(elapsedTime)} حل کردید!`, 'success');
                
                // ذخیره بازی حل شده
                saveSolvedGame();
                
                // پخش صدای برنده شدن
                playWinSound();
            }
        }

        // به روزرسانی نوار پیشرفت
        function updateProgress() {
            if (!gameActive) return;
            
            let correctCells = 0;
            let totalCellsToMark = 0;
            
            // شمارش سلول‌های صحیح علامت‌زده شده
            for (let r = 0; r < boardSize; r++) {
                for (let c = 0; c < boardSize; c++) {
                    if (solutionBoard[r][c] === 1) {
                        totalCellsToMark++;
                        if (gameBoard[r][c] === 1) {
                            correctCells++;
                        }
                    }
                }
            }
            
            const progress = totalCellsToMark > 0 ? Math.round((correctCells / totalCellsToMark) * 100) : 0;
            
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${progress}%`;
        }

        // شروع تایمر
        function startTimer() {
            startTime = Date.now() - elapsedTime * 1000;
            
            timerInterval = setInterval(() => {
                if (!gamePaused && gameActive) {
                    elapsedTime = Math.floor((Date.now() - startTime) / 1000);
                    document.getElementById('timer').textContent = formatTime(elapsedTime);
                }
            }, 1000);
        }

        // توقف تایمر
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // فرمت زمان به MM:SS
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // استفاده از راهنما
        function useHint() {
            if (!gameActive || gamePaused || gameWon || hintsRemaining <= 0) return;
            
            // پیدا کردن یک سلول صحیح که هنوز علامت‌زده نشده
            const availableCells = [];
            
            for (let r = 0; r < boardSize; r++) {
                for (let c = 0; c < boardSize; c++) {
                    if (solutionBoard[r][c] === 1 && gameBoard[r][c] !== 1) {
                        availableCells.push({r, c});
                    }
                }
            }
            
            if (availableCells.length === 0) return;
            
            // انتخاب تصادفی یک سلول
            const randomCell = availableCells[Math.floor(Math.random() * availableCells.length)];
            
            // علامت‌زدن سلول
            gameBoard[randomCell.r][randomCell.c] = 1;
            const cell = document.querySelector(`td[data-row="${randomCell.r}"][data-col="${randomCell.c}"]`);
            cell.classList.add('marked');
            cell.classList.remove('crossed');
            
            // اضافه کردن انیمیشن راهنما
            cell.classList.add('hint');
            setTimeout(() => {
                cell.classList.remove('hint');
            }, 1500);
            
            // کاهش تعداد راهنماها
            hintsRemaining--;
            document.getElementById('hintCount').textContent = hintsRemaining;
            
            // افزایش آمار راهنماهای استفاده شده
            totalHintsUsed++;
            saveStats();
            updateStatsDisplay();
            
            // بررسی برنده شدن
            checkWinCondition();
            
            // به روزرسانی پیشرفت
            updateProgress();
            
            // نمایش پیام
            showMessage(`یک مربع صحیح برای شما علامت‌زده شد! ${hintsRemaining} راهنمای باقیمانده.`, 'info');
        }

        // نمایش پیام
        function showMessage(text, type = 'info') {
            // ایجاد عنصر پیام
            const message = document.createElement('div');
            message.textContent = text;
            message.style.position = 'fixed';
            message.style.top = '20px';
            message.style.right = '50%';
            message.style.transform = 'translateX(50%)';
            message.style.padding = '15px 25px';
            message.style.borderRadius = '8px';
            message.style.fontWeight = '600';
            message.style.zIndex = '1000';
            message.style.boxShadow = 'var(--shadow-hover)';
            message.style.transition = 'opacity 0.3s';
            
            // رنگ‌بندی بر اساس نوع
            if (type === 'success') {
                message.style.backgroundColor = 'var(--success-color)';
                message.style.color = 'white';
            } else if (type === 'warning') {
                message.style.backgroundColor = 'var(--warning-color)';
                message.style.color = 'white';
            } else if (type === 'error') {
                message.style.backgroundColor = 'var(--danger-color)';
                message.style.color = 'white';
            } else {
                message.style.backgroundColor = 'var(--card-bg)';
                message.style.color = 'var(--text-color)';
                message.style.border = '1px solid var(--border-color)';
            }
            
            document.body.appendChild(message);
            
            // حذف خودکار پیام بعد از 3 ثانیه
            setTimeout(() => {
                message.style.opacity = '0';
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 300);
            }, 3000);
        }

        // ذخیره بازی حل شده
        function saveSolvedGame() {
            const solvedGames = JSON.parse(localStorage.getItem('nonogramSolvedGames')) || [];
            
            const gameData = {
                level: currentLevel,
                time: elapsedTime,
                date: new Date().toISOString(),
                hintsUsed: 5 - hintsRemaining,
                patternName: patterns[currentLevel].name
            };
            
            solvedGames.push(gameData);
            
            // نگه داشتن فقط 10 بازی آخر
            if (solvedGames.length > 10) {
                solvedGames.shift();
            }
            
            localStorage.setItem('nonogramSolvedGames', JSON.stringify(solvedGames));
        }

        // پخش صدای برنده شدن
        function playWinSound() {
            // ایجاد یک صدای ساده با Web Audio API
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // نت C
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // نت E
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // نت G
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log("پخش صدا پشتیبانی نمی‌شود");
            }
        }

        // نمایش مثال عملی
        function showExample() {
            const exampleBoard = [
                [1, 1, 0, 0, 0],
                [0, 1, 1, 0, 0],
                [0, 0, 1, 1, 0],
                [0, 0, 0, 1, 1],
                [1, 0, 0, 0, 1]
            ];
            
            let exampleHTML = '<div style="text-align: center; margin: 20px 0;">';
            exampleHTML += '<p style="margin-bottom: 15px;"><strong>مثال: پیکان مورب</strong></p>';
            exampleHTML += '<div style="display: inline-block; border: 2px solid var(--border-color); padding: 10px; background-color: var(--grid-bg);">';
            
            for (let r = 0; r < 5; r++) {
                exampleHTML += '<div style="display: flex;">';
                for (let c = 0; c < 5; c++) {
                    const bgColor = exampleBoard[r][c] === 1 ? 'var(--grid-marked)' : 'var(--grid-cell)';
                    exampleHTML += `<div style="width: 30px; height: 30px; border: 1px solid var(--grid-line); background-color: ${bgColor};"></div>`;
                }
                exampleHTML += '</div>';
            }
            
            exampleHTML += '</div>';
            exampleHTML += '<p style="margin-top: 15px;">اعداد سمت چپ: [2], [2], [2], [2], [1 1]</p>';
            exampleHTML += '<p>اعداد بالایی: [1 1], [1 1], [1 1], [1 1], [1 1]</p>';
            exampleHTML += '</div>';
            
            showMessage(exampleHTML, 'info');
        }

        // باز کردن مودال اشتراک‌گذاری
        function openShareModal() {
            const modal = document.getElementById('shareModal');
            modal.style.display = 'flex';
            
            // به روزرسانی پیام اشتراک‌گذاری
            const shareMessage = document.getElementById('shareMessage');
            if (gameWon) {
                shareMessage.textContent = `من یک نونوگرام سطح ${currentLevel} را در زمان ${formatTime(elapsedTime)} حل کردم!`;
            } else {
                shareMessage.textContent = `در حال حل نونوگرام سطح ${currentLevel} هستم، به من ملحق شوید!`;
            }
        }

        // بستن مودال اشتراک‌گذاری
        function closeShareModal() {
            const modal = document.getElementById('shareModal');
            modal.style.display = 'none';
        }

        // تنظیم رویدادهای اشتراک‌گذاری
        function setupShareButtons() {
            const shareUrl = 'https://intellsoft.ir/nonogram';
            const shareText = gameWon 
                ? `من یک نونوگرام سطح ${currentLevel} را در زمان ${formatTime(elapsedTime)} حل کردم!` 
                : `بازی نونوگرام پیکسل آرت - یک بازی فکری جذاب و چالش‌برانگیز!`;
            
            // توییتر
            document.getElementById('shareTwitter').addEventListener('click', () => {
                window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`, '_blank');
            });
            
            // فیسبوک
            document.getElementById('shareFacebook').addEventListener('click', () => {
                window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}&quote=${encodeURIComponent(shareText)}`, '_blank');
            });
            
            // تلگرام
            document.getElementById('shareTelegram').addEventListener('click', () => {
                window.open(`https://t.me/share/url?url=${encodeURIComponent(shareUrl)}&text=${encodeURIComponent(shareText)}`, '_blank');
            });
            
            // واتساپ
            document.getElementById('shareWhatsapp').addEventListener('click', () => {
                window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`, '_blank');
            });
        }

        // تغییر تم
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const themeToggle = document.getElementById('themeToggle');
            
            if (document.body.classList.contains('dark-theme')) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                localStorage.setItem('nonogramTheme', 'dark');
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                localStorage.setItem('nonogramTheme', 'light');
            }
        }

        // بارگذاری تم ذخیره شده
        function loadTheme() {
            const savedTheme = localStorage.getItem('nonogramTheme');
            const themeToggle = document.getElementById('themeToggle');
            
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        // رویدادهای صفحه کلید
        function setupKeyboardEvents() {
            document.addEventListener('keydown', (e) => {
                // Space برای تغییر حالت
                if (e.code === 'Space') {
                    e.preventDefault();
                    toggleGameMode();
                }
                
                // N برای بازی جدید
                if (e.code === 'KeyN' && e.ctrlKey) {
                    e.preventDefault();
                    startNewGame();
                }
                
                // H برای راهنما
                if (e.code === 'KeyH' && e.ctrlKey) {
                    e.preventDefault();
                    useHint();
                }
                
                // P برای توقف/ادامه
                if (e.code === 'KeyP' && e.ctrlKey) {
                    e.preventDefault();
                    togglePause();
                }
                
                // 1, 2, 3 برای تغییر سطح
                if (e.code === 'Digit1') {
                    startNewGame('easy');
                } else if (e.code === 'Digit2') {
                    startNewGame('medium');
                } else if (e.code === 'Digit3') {
                    startNewGame('hard');
                }
            });
        }

        // تغییر حالت بازی
        function toggleGameMode() {
            const markBtn = document.getElementById('markMode');
            const crossBtn = document.getElementById('crossMode');
            
            if (gameMode === 'mark') {
                gameMode = 'cross';
                markBtn.classList.remove('btn-primary');
                markBtn.classList.add('btn-outline');
                crossBtn.classList.remove('btn-outline');
                crossBtn.classList.add('btn-primary');
                showMessage('حالت خط‌زدن فعال شد', 'info');
            } else {
                gameMode = 'mark';
                crossBtn.classList.remove('btn-primary');
                crossBtn.classList.add('btn-outline');
                markBtn.classList.remove('btn-outline');
                markBtn.classList.add('btn-primary');
                showMessage('حالت علامت‌گذاری فعال شد', 'info');
            }
        }

        // توقف/ادامه بازی
        function togglePause() {
            if (!gameActive || gameWon) return;
            
            const pauseBtn = document.getElementById('pauseBtn');
            
            if (gamePaused) {
                gamePaused = false;
                pauseBtn.innerHTML = '<i class="fas fa-pause"></i> توقف';
                startTime = Date.now() - elapsedTime * 1000;
                showMessage('بازی ادامه یافت', 'info');
            } else {
                gamePaused = true;
                pauseBtn.innerHTML = '<i class="fas fa-play"></i> ادامه';
                showMessage('بازی متوقف شد', 'warning');
            }
        }

        // راه�اندازی اولیه بازی
        function initGame() {
            // بارگذاری آمار و تم
            loadStats();
            loadTheme();
            
            // تنظیم رویدادها
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            document.getElementById('newGameBtn').addEventListener('click', () => startNewGame());
            document.getElementById('hintBtn').addEventListener('click', useHint);
            document.getElementById('shareBtn').addEventListener('click', openShareModal);
            document.getElementById('closeModal').addEventListener('click', closeShareModal);
            document.getElementById('pauseBtn').addEventListener('click', togglePause);
            document.getElementById('showExampleBtn').addEventListener('click', showExample);
            
            // رویدادهای دکمه‌های حالت بازی
            document.getElementById('markMode').addEventListener('click', () => {
                if (gameMode !== 'mark') toggleGameMode();
            });
            
            document.getElementById('crossMode').addEventListener('click', () => {
                if (gameMode !== 'cross') toggleGameMode();
            });
            
            // رویدادهای دکمه‌های سطح دشواری
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    startNewGame(btn.dataset.level);
                });
            });
            
            // تنظیم رویدادهای اشتراک‌گذاری
            setupShareButtons();
            
            // تنظیم رویدادهای صفحه کلید
            setupKeyboardEvents();
            
            // بستن مودال با کلیک خارج از آن
            document.getElementById('shareModal').addEventListener('click', (e) => {
                if (e.target.id === 'shareModal') {
                    closeShareModal();
                }
            });
            
            // شروع اولین بازی
            startNewGame('easy');
        }

        // راه‌اندازی بازی زمانی که صفحه بارگذاری شد
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>